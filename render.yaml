services:
  # Frontend - Static Site with SPA routing
  - type: web
    name: udemy-clone-client
    runtime: static
    rootDir: client
    buildCommand: pnpm install && pnpm run build
    staticPublishPath: ./build
    envVars:
      - key: NODE_VERSION
        value: "20"
    routes:
      - type: rewrite
        source: /*
        destination: /index.html

  # Backend - Node.js Web Service
  - type: web
    name: udemy-clone-server
    runtime: node
    rootDir: server
    buildCommand: pnpm install
    startCommand: pnpm run start
    envVars:
      - key: NODE_VERSION
        value: "20"
      - key: NODE_ENV
        value: production
